// ==========================================================================
// Project:   Ember Touch - Touch and Gesture Library For Ember
// Copyright: ©2006-2011 Strobe Inc. and contributors.
//            Portions ©2008-2011 Apple Inc. All rights reserved.
// License:   Licensed under MIT license (see license.js)
// ==========================================================================

(function(a){var b=Em.get,c=Em.set;Em.Gestures=Em.Object.create({_registeredGestures:null,init:function(){return this._registeredGestures={},this._super()},register:function(a,b){var c=this._registeredGestures;if(c[a]!==undefined)throw new Em.Error(a+" already exists as a registered gesture recognizers. Gesture recognizers must have globally unique names.");c[a]=b},unregister:function(a){var b=this._registeredGestures;b[a]!==undefined&&(b[a]=undefined)},knownGestures:function(){var a=this._registeredGestures;return a?a:{}}})})({}),function(a){var b=Em.get,c=Em.set;Em.GestureManager=Em.Object.extend({gestures:null,_redispatchQueue:null,_redispatchToNearestParentViewWaitingForTouches:function(a,c){var d=null,e=!1,c=b(c,"parentView");while(c){var f=b(c,"eventManager");if(f!==undefined&&f!==null){var g=b(f,"gestures");for(var h=0,i=g.length;h<i;h++)b(g[h],"state")===Em.Gesture.WAITING_FOR_TOUCHES&&(d=f);if(d){e=!0,d.touchStart(a,c);break}}c=b(c,"parentView")}return e},touchStart:function(a,b){if(this._redispatchToNearestParentViewWaitingForTouches(a,b))return;return this._invokeEvent("touchStart",a,b)},touchMove:function(a,b){return this._invokeEvent("touchMove",a,b)},touchEnd:function(a,b){return this._invokeEvent("touchEnd",a,b)},touchCancel:function(a,b){return this._invokeEvent("touchCancel",a,b)},_invokeEvent:function(a,d,e){var f=b(this,"gestures"),g,h=!0,i=!1;this._redispatchQueue={};for(var j=0,k=f.length;j<k;j++)g=f[j],handler=g[a],Em.typeOf(handler)==="function"&&(c(g,"currentEventObject",d),h=handler.call(g,d,e,this),i=!0);if(!i){var l=b(e,"parentView");if(l){var m=b(l,"eventManager");m!==undefined&&m!==null&&m._invokeEvent(a,d,l)}}return this._flushReDispatchQueue(),h},redispatchEventToView:function(a,b,c){var d=this._redispatchQueue;if(d[b]===undefined)d[b]=[];else{var e=d[b];for(var f=0,g=e.length;f<g;f++)if(a===e[f].view)return}var h=null;c&&c.originalEvent&&(h=c.originalEvent),d[b].push({view:a,originalEvent:h})},_flushReDispatchQueue:function(){var a=this._redispatchQueue;for(var b in a){var c=a[b];for(var d=0,e=c.length;d<e;d++){var f=c[d].view,g=jQuery.Event(b);g.originalEvent=c[d].originalEvent,f.$().trigger(g,this)}}}})}({}),function(a){var b=Em.get,c=Em.set;Em.TouchList=Em.Object.extend({touches:null,timestamp:null,init:function(){this._super(),c(this,"touches",[])},addTouch:function(a){var c=b(this,"touches");c.push(a),this.notifyPropertyChange("touches")},updateTouch:function(a){var c=b(this,"touches");for(var d=0,e=c.length;d<e;d++){var f=c[d];if(f.identifier===a.identifier){c[d]=a,this.notifyPropertyChange("touches");break}}},removeTouch:function(a){var c=b(this,"touches");for(var d=0,e=c.length;d<e;d++){var f=c[d];if(f.identifier===a.identifier){c.splice(d,1),this.notifyPropertyChange("touches");break}}},removeAllTouches:function(){c(this,"touches",[])},touchWithId:function(a){var c=null,d=b(this,"touches");for(var e=0,f=d.length;e<f;e++){var g=d[e];if(g.identifier===a){c=g;break}}return c},length:Ember.computed(function(){var a=b(this,"touches");return a.length}).property("touches").cacheable()})}({}),function(a){var b=Em.get,c=Em.set,d=100;Em.Gesture=Em.Object.extend({state:null,name:null,currentEventObject:null,gestureIsDiscrete:!1,preventDefaultOnChange:!1,touches:null,numberOfActiveTouches:0,numberOfRequiredTouches:1,onBeganGestureView:null,init:function(){this._super(),this.touches=Em.TouchList.create()},didBecomePossible:function(){},shouldBegin:function(){return!0},didBegin:function(){},didChange:function(){},eventWasRejected:function(){},shouldEnd:function(){return!0},didEnd:function(){},didCancel:function(){},attemptGestureEventDelivery:function(a,b){var c=this.notifyViewOfGestureEvent(a,b);c||this.eventWasRejected()},distance:function(a){if(a.length<2)return 0;var b=a[0],c=a[1],d=b.pageX,e=b.pageY,f=c.pageX,g=c.pageY;return Math.sqrt((d-=f)*d+(e-=g)*e)},centerPointForTouches:function(a){var b=0,c=0;for(var d=0,e=a.length;d<e;d++){var f=a[d];b+=f.pageX,c+=f.pageY}var g={x:b/a.length,y:c/a.length};return g},_objectValues:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},notifyViewOfGestureEvent:function(a,b,c){var d=a[b],e=!1;return Em.typeOf(d)==="function"&&(e=d.call(a,this,c)),e},toString:function(){return Em.Gesture+"<"+Em.guidFor(this)+">"},_resetState:function(){this.touches.removeAllTouches()},touchStart:function(a,d,e){var f=a.originalEvent.targetTouches,g=this.touches,h=b(this,"state");c(g,"timestamp",Date.now());for(var i=0,j=f.length;i<j;i++){var k=f[i];g.touchWithId(k.identifier)===null&&g.get("length")<b(this,"numberOfRequiredTouches")&&g.addTouch(k)}g.get("length")<b(this,"numberOfRequiredTouches")?c(this,"state",Em.Gesture.WAITING_FOR_TOUCHES):this.gestureIsDiscrete?this.shouldBegin()&&(c(this,"state",Em.Gesture.BEGAN),c(this,"onBeganGestureView",d),this.didBegin()):(c(this,"state",Em.Gesture.POSSIBLE),this.didBecomePossible()),e.redispatchEventToView(d,"touchstart",a)},touchMove:function(a,d,e){var f=b(this,"state");if(f===Em.Gesture.WAITING_FOR_TOUCHES||f===Em.Gesture.ENDED||f===Em.Gesture.CANCELLED){e.redispatchEventToView(d,"touchmove",a);return}var g=a.originalEvent.changedTouches,h=this.touches;c(h,"timestamp",Date.now());for(var i=0,j=g.length;i<j;i++){var k=g[i];h.updateTouch(k)}if(f===Em.Gesture.POSSIBLE&&!this.gestureIsDiscrete)this.shouldBegin()&&(c(this,"state",Em.Gesture.BEGAN),c(this,"onBeganGestureView",d),this.didBegin(),this.didChange(),this.preventDefaultOnChange&&a.preventDefault(),this.attemptGestureEventDelivery(d,b(this,"name")+"Start"));else if(f===Em.Gesture.BEGAN||f===Em.Gesture.CHANGED)c(this,"state",Em.Gesture.CHANGED),this.didChange(),this.preventDefaultOnChange&&a.preventDefault(),this.gestureIsDiscrete||this.attemptGestureEventDelivery(d,b(this,"name")+"Change");e.redispatchEventToView(d,"touchmove",a)},touchEnd:function(a,d,e){var f=b(this,"state"),g=this.touches;c(g,"timestamp",Date.now());var h=a&&a.originalEvent?a.originalEvent.changedTouches:undefined;if(h)for(var i=0,j=h.length;i<j;i++){var k=h[i];g.updateTouch(k)}if(this.gestureIsDiscrete)f===Em.Gesture.BEGAN||f===Em.Gesture.CHANGED?this.shouldEnd()?(c(this,"state",Em.Gesture.ENDED),this.didEnd(),this.attemptGestureEventDelivery(d,b(this,"name")+"End")):(c(this,"state",Em.Gesture.CANCELLED),this.didCancel()):e.redispatchEventToView(d,"touchend",a);else if(f===Em.Gesture.BEGAN||f===Em.Gesture.CHANGED)this.shouldEnd()?(c(this,"state",Em.Gesture.ENDED),this.didEnd(),this.attemptGestureEventDelivery(d,b(this,"name")+"End")):e.redispatchEventToView(d,"touchend",a);this._resetState()},touchCancel:function(a,d,e){var f=b(this,"state");f!==Em.Gesture.CANCELLED?(c(this,"state",Em.Gesture.CANCELLED),this.didCancel(),this.gestureIsDiscrete||this.notifyViewOfGestureEvent(d,b(this,"name")+"Cancel")):e.redispatchEventToView(d,"touchcancel",a),this._resetState()}}),Em.Gesture.WAITING_FOR_TOUCHES=0,Em.Gesture.POSSIBLE=1,Em.Gesture.BEGAN=2,Em.Gesture.CHANGED=3,Em.Gesture.ENDED=4,Em.Gesture.CANCELLED=5}({}),function(a){var b=Em.get,c=Em.set,d=100;Em.PinchGestureRecognizer=Em.Gesture.extend({scale:1,numberOfRequiredTouches:2,_startingDistanceBetweenTouches:null,_previousTimestamp:null,_previousDistance:0,_deltaThreshold:5,_previousScale:1,didBecomePossible:function(){this._startingDistanceBetweenTouches=this.distance(b(this.touches,"touches")),this._previousDistance=this._startingDistanceBetweenTouches,this._previousTimestamp=b(this.touches,"timestamp")},shouldBegin:function(){var a=this.distance(b(this.touches,"touches"));return Math.abs(a-this._startingDistanceBetweenTouches)>=this._deltaThreshold},didChange:function(){var a=this._previousScale=b(this,"scale"),d=this.touches.timestamp-this._previousTimestamp,e=this.distance(b(this.touches,"touches")),f=e-this._previousDistance;c(this,"velocity",f/d),c(this,"scale",e/this._previousDistance),this._previousTimestamp=b(this.touches,"timestamp"),this._previousDistance=e},eventWasRejected:function(){c(this,"scale",this._previousScale)}}),Em.Gestures.register("pinch",Em.PinchGestureRecognizer)}({}),function(a){var b=Em.get,c=Em.set,d=0;Em.PanGestureRecognizer=Em.Gesture.extend({translation:null,_previousLocation:null,_previousTranslation:null,_translationThreshold:5,init:function(){this._super(),c(this,"translation",{x:0,y:0})},didBecomePossible:function(){this._previousLocation=this.centerPointForTouches(b(this.touches,"touches"))},shouldBegin:function(){var a=this._previousLocation,c=this.centerPointForTouches(b(this.touches,"touches")),d=a.x,e=a.y,f=c.x,g=c.y,h=Math.sqrt((d-=f)*d+(e-=g)*e);return h>=this._translationThreshold},didChange:function(){var a=this._previousLocation,d=this.centerPointForTouches(b(this.touches,"touches")),e={x:d.x,y:d.y};e.x=d.x-a.x,e.y=d.y-a.y,this._previousTranslation=b(this,"translation"),c(this,"translation",e),this._previousLocation=d},eventWasRejected:function(){c(this,"translation",this._previousTranslation)}}),Em.Gestures.register("pan",Em.PanGestureRecognizer)}({}),function(a){var b=Em.get,c=Em.set;Em.TapGestureRecognizer=Em.Gesture.extend({numberOfTaps:1,MULTITAP_DELAY:150,gestureIsDiscrete:!0,_initialLocation:null,_waitingInterval:null,_waitingForMoreTouches:!1,_moveThreshold:10,shouldBegin:function(){return b(this.touches,"length")===b(this,"numberOfRequiredTouches")},didBegin:function(){this._initialLocation=this.centerPointForTouches(b(this.touches,"touches")),b(this.touches,"length")<b(this,"numberOfTaps")&&(this._waitingForMoreTouches=!0,this._waitingInterval=window.setInterval(this._intervalFired,this.MULTITAP_DELAY))},shouldEnd:function(){var a=this.centerPointForTouches(b(this.touches,"touches")),c=this._initialLocation.x,d=this._initialLocation.y,e=a.x,f=a.y,g=Math.sqrt((c-=e)*c+(d-=f)*d);return Math.abs(g)<this._moveThreshold&&!this._waitingForMoreTouches},didEnd:function(){this._initialLocation=null},didCancel:function(){this._initialLocation=null},_intervalFired:function(){window.clearInterval(this._waitingInterval),_waitingForMoreTouches=!1}}),Em.Gestures.register("tap",Em.TapGestureRecognizer)}({}),function(a){var b=Em.get,c=Em.set;Em.PressGestureRecognizer=Em.Gesture.extend({pressPeriodThreshold:500,gestureIsDiscrete:!0,_initialLocation:null,_moveThreshold:10,_initialTimestamp:null,shouldBegin:function(){return b(this.touches,"length")===b(this,"numberOfRequiredTouches")},didBegin:function(){this._initialLocation=this.centerPointForTouches(b(this.touches,"touches")),this._initialTimestamp=b(this.touches,"timestamp")},shouldEnd:function(){var a=this.centerPointForTouches(b(this.touches,"touches")),c=this._initialLocation.x,d=this._initialLocation.y,e=a.x,f=a.y,g=Math.sqrt((c-=e)*c+(d-=f)*d),h=Math.abs(g)<this._moveThreshold,i=b(this.touches,"timestamp"),j=i-this._initialTimestamp>=this.pressPeriodThreshold;return h&&j},didEnd:function(){this._resetCounters()},didCancel:function(){this._resetCounters()},_resetCounters:function(){this._initialLocation=null,this._initialTimestamp=null},toString:function(){return Em.PressGestureRecognizer+"<"+Em.guidFor(this)+">"}}),Em.Gestures.register("press",Em.PressGestureRecognizer)}({}),function(a){var b=Em.get,c=Em.set;Em.TouchHoldGestureRecognizer=Em.Gesture.extend({holdPeriod:2e3,moveThreshold:50,gestureIsDiscrete:!0,_endInterval:null,_targetElement:null,shouldBegin:function(){return b(this.touches,"length")===b(this,"numberOfRequiredTouches")},didBegin:function(){this._initialLocation=this.centerPointForTouches(b(this.touches,"touches"));var a=b(this.touches,"touches")[0].target;c(this,"_target",a);var d=this;this._endInterval=window.setInterval(function(){d._endFired(d)},this.holdPeriod)},didChange:function(){var a=this.centerPointForTouches(b(this.touches,"touches")),d=this._initialLocation.x,e=this._initialLocation.y,f=a.x,g=a.y,h=Math.sqrt((d-=f)*d+(e-=g)*e),i=Math.abs(h)<this.moveThreshold;i||(this._disableEndFired(),c(this,"state",Em.Gesture.CANCELLED))},shouldEnd:function(){return this._disableEndFired(),!1},_endFired:function(){this._disableEndFired();if(this.state===Em.Gesture.BEGAN||this.state===Em.Gesture.CHANGED){c(this,"state",Em.Gesture.ENDED);var a=b(this,"onBeganGestureView"),d=b(this,"name")+"End";this.attemptGestureEventDelivery(a,d)}},_disableEndFired:function(){window.clearInterval(this._endInterval)},toString:function(){return Em.TouchHoldGestureRecognizer+"<"+Em.guidFor(this)+">"}}),Em.Gestures.register("touchHold",Em.TouchHoldGestureRecognizer)}({}),function(a){}({}),function(a){var b=Em.get,c=Em.set;Em.View.reopen({eventManager:null,init:function(){this._super();var a=Em.Gestures.knownGestures(),d=b(this,"eventManager");if(a&&!d){var e=[];for(var f in a)if(this[f+"Start"]||this[f+"Change"]||this[f+"End"]){var g;this[f+"Options"]!==undefined&&typeof this[f+"Options"]=="object"?g=this[f+"Options"]:g={},g.name=f,g.view=this,e.push(a[f].create(g))}var h=Em.GestureManager.create({gestures:e});c(this,"eventManager",h)}}})}({}),function(a){}({}),function(a){}({})
